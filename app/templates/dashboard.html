<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codex Dashboard</title>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div class="card">
        <div class="card__header">
            <h1 class="card__title">Codex</h1>
        </div>
        <div class="card__body">
            <div class="dashboard-grid">
                <a href="{{ url_for('companies.list_companies') }}" class="dashboard-card">
                    <div class="dashboard-card__icon">
                        <i data-lucide="building-2"></i>
                    </div>
                    <div class="dashboard-card__content">
                        <h2 class="dashboard-card__title">Companies</h2>
                        <p class="dashboard-card__count">{{ company_count }}</p>
                    </div>
                </a>

                <a href="{{ url_for('contacts.list_contacts') }}" class="dashboard-card">
                    <div class="dashboard-card__icon">
                        <i data-lucide="users"></i>
                    </div>
                    <div class="dashboard-card__content">
                        <h2 class="dashboard-card__title">Contacts</h2>
                        <p class="dashboard-card__count">{{ contact_count }}</p>
                    </div>
                </a>

                <a href="{{ url_for('assets.list_assets') }}" class="dashboard-card">
                    <div class="dashboard-card__icon">
                        <i data-lucide="hard-drive"></i>
                    </div>
                    <div class="dashboard-card__content">
                        <h2 class="dashboard-card__title">Assets</h2>
                        <p class="dashboard-card__count">{{ asset_count }}</p>
                    </div>
                </a>

                {% if user.permission_level == 'admin' %}
                <a href="{{ url_for('agents_dashboard') }}" class="dashboard-card">
                    <div class="dashboard-card__icon">
                        <i data-lucide="user-cog"></i>
                    </div>
                    <div class="dashboard-card__content">
                        <h2 class="dashboard-card__title">Agents</h2>
                        <p class="dashboard-card__count" id="agent-count">Loading...</p>
                    </div>
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    {% if user.permission_level == 'admin' %}
    <div class="card">
        <div class="card__header">
            <h2 class="card__title">Settings</h2>
        </div>
        <div class="card__body">
            <div class="u-flex u-flex-gap">
                <a href="{{ url_for('admin.settings') }}">
                    <button class="btn btn--primary">
                        <span class="btn__label">
                            <i data-lucide="settings" class="btn__icon"></i>
                            Admin Settings
                        </span>
                    </button>
                </a>
                <a href="{{ url_for('billing_plans.list_plans') }}">
                    <button class="btn btn--primary">
                        <span class="btn__label">
                            <i data-lucide="dollar-sign" class="btn__icon"></i>
                            Billing Plans
                        </span>
                    </button>
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <script>
        async function loadAgentCount() {
            try {
                const basePath = window.location.pathname.startsWith('/codex/') ? '/codex' : '';
                const response = await fetch(`${basePath}/api/agents`);
                const data = await response.json();

                const countElem = document.getElementById('agent-count');
                if (countElem) {
                    countElem.textContent = data.total || 0;
                }
            } catch (error) {
                console.error('Error loading agent count:', error);
                const countElem = document.getElementById('agent-count');
                if (countElem) {
                    countElem.textContent = '0';
                }
            }
        }

        // Load agent count and initialize Lucide icons
        window.addEventListener('DOMContentLoaded', () => {
            loadAgentCount();
            lucide.createIcons();
        });
    </script>
</body>
</html>
